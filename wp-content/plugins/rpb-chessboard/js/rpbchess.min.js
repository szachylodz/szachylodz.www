var RPBChess=function(){"use strict";function St(e){this.fun=e}function xt(e,t){this.fen=e,this[q]=t;for(var n=2;n<arguments[a];++n){var r=new RegExp("%"+(n-1)+"\\$s");this[q]=this[q].replace(r,arguments[n])}}function Tt(e,t,n){this.position=e,this.notation=t,this[q]=n;for(var r=3;r<arguments[a];++r){var i=new RegExp("%"+(r-2)+"\\$s");this[q]=this[q].replace(i,arguments[r])}}function $t(e){return e>=2&&e<=7}function Jt(e){return e>=1&&e<=4}function Yt(e){if(typeof e===o){if(/^[aceg][1357]$/[G](e)||/^[bdfh][2468]$/[G](e))return"b";if(/^[aceg][2468]$/[G](e)||/^[bdfh][1357]$/[G](e))return"w"}throw new St("squareColor()")}function Zt(e){if(typeof e!==o||!/^[a-h][1-8]$/[G](e))return c;var t=sn[u](e[0]),n=rn[u](e[1]);return{r:n,c:t}}function on(e){if(typeof e!==o||!/^[a-h][1-8]$/[G](e))return-1;var t=sn[u](e[0]),n=rn[u](e[1]);return n*16+t}function un(e){return typeof e===o?nn[u](e):-1}function an(e){return sn[e%16]+rn[Math[K](e/16)]}function fn(n){typeof n===m||n===c||n==="start"?this.reset():n==="empty"?this.clear():n instanceof fn?(this[t]=n[t].slice(),this[e]=n[e],this[i]=n[i].slice(),this[r]=n[r],this[d]=n[d],this[v]=n[v].slice()):cn(this,n,s)}function ln(n,s,o){var u="";for(var a=7;a>=0;--a){a!==7&&(u+="/");var f=0;for(var l=0;l<8;++l){var c=n[t][a*16+l];c<0?++f:(f>0&&(u+=f,f=0),u+=en[c])}f>0&&(u+=f)}return u+=yt+nn[n[e]]+yt+hn(n[i])+yt,n[r]<0?u+=lt:u+=sn[n[r]]+(n[e]===Nt?"6":"3"),u+=yt+s+yt+o,u}function cn(n,s,o){s=s.replace(/^\s+|\s+$/g,"");var f=s.split(/\s+/);if(f[a]!==6)throw new xt(s,Et[U]);var l=f[0].split("/");if(l[a]!==8)throw new xt(s,Et[N]);n.clear(),n[d]=c;for(var h=7;h>=0;--h){var p=l[7-h],v=0,m=0;while(v<p[a]&&m<8){var y=p[v],b=en[u](y);if(/^[1-8]$/[G](y))m+=parseInt(y,10);else{if(!(b>=0))throw new xt(s,Et[k],y);n[t][h*16+m]=b,++m}++v}if(v!==p[a]||m!==8)throw new xt(s,Et[T],Et[rt][7-h])}n[e]=nn[u](f[1]);if(n[e]<0)throw new xt(s,Et[st]);n[i]=pn(f[2],o);if(n[i]===c)throw new xt(s,Et[j]);var w=f[3];if(w!==lt){if(!/^[a-h][36]$/[G](w))throw new xt(s,Et[V]);if(o&&(w[1]==="3"&&n[e]===Nt||w[1]==="6"&&n[e]===Ct))throw new xt(s,Et[M]);n[r]=sn[u](w[0])}var E=o?/^(?:0|[1-9][0-9]*)$/:/^[0-9]+$/;if(!E[G](f[4]))throw new xt(s,Et[g],Et[rt][4]);if(!E[G](f[5]))throw new xt(s,Et[g],Et[rt][5]);return{fiftyMoveClock:parseInt(f[4],10),fullMoveNumber:parseInt(f[5],10)}}function hn(e){var t="";return e[Nt]&128&&(t+="K"),e[Nt]&1&&(t+="Q"),e[Ct]&128&&(t+="k"),e[Ct]&1&&(t+="q"),t===""?lt:t}function pn(e,t){var n=[0,0];return e===lt?n:(t?/^K?Q?k?q?$/:/^[KQkq]*$/)[G](e)?(e[u]("K")>=0&&(n[Nt]|=128),e[u]("Q")>=0&&(n[Nt]|=1),e[u]("k")>=0&&(n[Ct]|=128),e[u]("q")>=0&&(n[Ct]|=1),n):c}function dn(e,n){var r=e[t][n];return r<0?lt:{piece:tn[Math[K](r/2)],color:nn[r%2]}}function vn(e,n,r){if(r===lt)return e[t][n]=kt,e[d]=c,h;if(typeof r===ht&&typeof r.piece===o&&typeof r.color===o){var i=tn[u](r.piece),a=nn[u](r.color);if(i>=0&&a>=0)return e[t][n]=i*2+a,e[d]=c,h}return s}function mn(t){return nn[t[e]]}function gn(t,n){var r=un(n);return r>=0?(t[e]=r,t[d]=c,h):s}function yn(e,t,n){return(e[i][t]&1<<n)!==0}function bn(e,t,n,r){return typeof r===ft?(r?e[i][t]|=1<<n:e[i][t]&=~(1<<n),e[d]=c,h):s}function wn(e){return e[r]<0?lt:sn[e[r]]}function En(e,t){if(t===lt)return e[r]=-1,e[d]=c,h;if(typeof t===o){var n=sn[u](t);if(n>=0)return e[r]=n,e[d]=c,h}return s}function Sn(e,n,r){var i=Kt[r];if($t(r))for(var o=0;o<i[a];++o){var u=n;while(h){u-=i[o];if((u&136)===0){var f=e[t][u];if(f===r)return h;if(f===kt)continue}break}}else for(var o=0;o<i[a];++o){var u=n-i[o];if((u&136)===0&&e[t][u]===r)return h}return s}function xn(e,t,n){for(var r=0;r<6;++r)if(Sn(e,t,r*2+n))return h;return s}function Tn(n){if(n[d]!==c)return;n[d]=s,Nn(n,Nt),Nn(n,Ct);if(n[v][Nt]<0||n[v][Ct]<0)return;if(xn(n,n[v][1-n[e]],n[e]))return;for(var i=0;i<8;++i){var o=n[t][i],u=n[t][112+i];if(o===Xt||u===Xt||o===Vt||u===Vt)return}for(var a=0;a<2;++a){var f=!yn(n,a,7),l=!yn(n,a,0),p=f||n[t][7+112*a]===Mt*2+a,m=l||n[t][0+112*a]===Mt*2+a,g=f&&l||n[t][4+112*a]===At*2+a;if(!(g&&m&&p))return}if(n[r]>=0){var y=(6-n[e]*5)*16+n[r],b=(5-n[e]*3)*16+n[r],w=(4-n[e])*16+n[r];if(n[t][y]!==kt||n[t][b]!==kt||n[t][w]!==Pt*2+1-n[e])return}n[d]=h}function Nn(e,n){var r=At*2+n;e[v][n]=-1;for(var i=0;i<120;i+=(i&7)===7?9:1)if(e[t][i]===r){if(!(e[v][n]<0)){e[v][n]=-1;return}e[v][n]=i}}function kn(){if(arguments[0]instanceof kn)this[H]=Cn[ot],this[p]=arguments[0][p],this[B]=arguments[0][B],this[L]=arguments[0][L],this[z]=arguments[0][z],this._to=arguments[0]._to,this[tt]=arguments[1];else{this[H]=arguments[0],this[p]=arguments[1],this[B]=arguments[2],this[L]=arguments[3],this[z]=arguments[4],this._to=arguments[5];switch(this[H]){case Cn[b]:this[pt]=arguments[6],this._rookTo=arguments[7];break;case Cn[w]:this[X]=arguments[6];break;case Cn[y]:this[x]=arguments[6];break;default:}}}function Ln(n,o){if(!n[D]())return;for(var u=0;u<120;u+=(u&7)===7?9:1){var f=n[t][u],l=Math[K](f/2);if(f<0||f%2!==n[e])continue;if(l===Pt){var c=Kt[f];for(var h=0;h<c[a];++h){var p=u+c[h];if((p&136)===0){var d=n[t][p];d>=0&&d%2!==n[e]?o(On(n,u,p,-1,-1),p<8||p>=112):d<0&&p===(5-n[e]*3)*16+n[r]&&o(On(n,u,p,(4-n[e])*16+n[r],-1),s)}}var v=16-n[e]*32,p=u+v;if(n[t][p]<0){o(On(n,u,p,-1,-1),p<8||p>=112);var m=(1+n[e]*5)*16;u>=m&&u<m+8&&(p+=v,n[t][p]<0&&o(On(n,u,p,-1,u%8),s))}}else if($t(f)){var g=Kt[f];for(var h=0;h<g[a];++h)for(var p=u+g[h];(p&136)===0;p+=g[h]){var d=n[t][p];(d<0||d%2!==n[e])&&o(On(n,u,p,-1,-1),s);if(d>=0)break}}else{var g=Kt[f];for(var h=0;h<g[a];++h){var p=u+g[h];if((p&136)===0){var d=n[t][p];(d<0||d%2!==n[e])&&o(On(n,u,p,-1,-1),s)}}}if(l===At&&n[i][n[e]]!==0){var p=[u-2,u+2];for(var h=0;h<p[a];++h)o(Mn(n,u,p[h]),s)}}}function An(n,i,o,u){if(!n[D]())return s;var a=n[t][i],f=n[t][o],l=Math[K](a/2);if(a<0||a%2!==n[e])return s;if(l===Pt&&(o<8||o>=112)){if(!Jt(u))return s}else if(u>=0)return s;var c=o-i+119,h=-1,p=-1;if((Qt[c]&1<<a)===0){if(l!==Pt||c!==151-n[e]*64)return l!==At||c!==117&&c!==121?s:Mn(n,i,o);var d=(1+n[e]*5)*16;if(i<d||i>=d+8)return s;p=i%8}if(l===Pt){if(c===135-n[e]*32||p>=0){if(f!==kt)return s}else if(f===kt){if(n[r]<0||o!==(5-n[e]*3)*16+n[r])return s;h=(4-n[e])*16+n[r]}else if(f%2===n[e])return s}else if(f>=0&&f%2===n[e])return s;if($t(a)){var v=Gt[c];for(var m=i+v;m!==o;m+=v)if(n[t][m]!==kt)return s}else if(p>=0&&n[t][(i+o)/2]!==kt)return s;var g=On(n,i,o,h,p);return g&&u>=0?new kn(g,u):g}function On(n,r,i,o,u){var a=n[t][r],f=n[t][i],l=Math[K](a/2);n[t][i]=a,n[t][r]=kt,o>=0&&(n[t][o]=kt);var c=l===At?i:n[v][n[e]],p=xn(n,c,1-n[e]);return n[t][r]=a,n[t][i]=f,o>=0&&(n[t][o]=Pt*2+1-n[e]),p?s:o>=0?new kn(Cn[w],l,n[e],h,r,i,o):u>=0?new kn(Cn[y],l,n[e],s,r,i,u):new kn(Cn.NORMAL_MOVE,l,n[e],f>=0,r,i)}function Mn(n,r,o){var u=r<o?7:0;if((n[i][n[e]]&1<<u)===0)return s;var a=u+n[e]*112,f=(r+o)/2,l=r<a?1:-1;for(var c=r+l;c!==a;c+=l)if(n[t][c]!==kt)return s;var h=1-n[e];return xn(n,r,h)||xn(n,o,h)||xn(n,f,h)?s:new kn(Cn[b],At,n[e],s,r,o,a,f)}function _n(e,t){var n="";return t[H]===Cn[b]?n=t[z]<t._to?"O-O":"O-O-O":t[p]===Pt?(t[L]&&(n+=sn[t[z]%16]+"x"),n+=an(t._to),t[H]===Cn[ot]&&(n+="="+tn[t[tt]].toUpperCase())):(n+=tn[t[p]].toUpperCase(),n+=Pn(e,t[z],t._to),t[L]&&(n+="x"),n+=an(t._to)),n+=Dn(e,t),n}function Dn(e,t){var n=new fn(e);return n.play(t),n.isCheck()?n[gt]()?"+":"#":""}function Pn(e,n,r){var i=Hn(e,r,e[t][n]);if(i[a]>=2){var o=s,u=s,f=s,l=Math[K](n/16),c=n%16;for(var p=0;p<i[a];++p){var d=i[p];if(d===n)continue;On(e,d,r,-1,-1)&&(o=h,l===Math[K](d/16)&&(u=h),c===d%16&&(f=h))}return f?u?an(n):rn[l]:o?sn[c]:""}return""}function Hn(e,n,r){var i=[],s=Kt[r];if($t(r))for(var o=0;o<s[a];++o){var u=n;while(h){u-=s[o];if((u&136)===0){var f=e[t][u];if(f===r)i.push(u);else if(f===kt)continue}break}}else for(var o=0;o<s[a];++o){var u=n-s[o];(u&136)===0&&e[t][u]===r&&i.push(u)}return i}function Bn(n,r,i){var s=/^(?:(O-O-O)|(O-O)|([KQRBN])([a-h])?([1-8])?(x)?([a-h][1-8])|(?:([a-h])(x)?)?([a-h][1-8])(?:(=)?([KQRBNP]))?)([\+#])?$/.exec(r);if(s===c)throw new Tt(n,r,Et[_]);if(!n[D]())throw new Tt(n,r,Et[ct]);var o=c;if(s[1]||s[2]){var f=n[v][n[e]],l=f+(s[2]?2:-2);o=Mn(n,f,l);if(!o){var h=s[2]?Et[W]:Et[I];throw new Tt(n,r,h)}}else if(s[3]){var p=tn[u](s[3].toLowerCase()),l=on(s[7]),d=n[t][l];if(d>=0&&d%2===n[e])throw new Tt(n,r,Et[O]);var m=Hn(n,l,p*2+n[e]);if(s[4]){var g=sn[u](s[4]);m=m.filter(function(e){return e%16===g})}if(s[5]){var y=rn[u](s[5]);m=m.filter(function(e){return Math[K](e/16)===y})}if(m[a]===0){var h=s[4]||s[5]?Et[A]:Et[nt];throw new Tt(n,r,h,s[3],s[7])}for(var b=0;b<m[a];++b){var w=On(n,m[b],l,-1,-1);if(w){if(o!==c)throw new Tt(n,r,Et[et],s[3],s[7]);o=w}}if(o===c){var h=n[e]===Nt?Et[E]:Et[S];throw new Tt(n,r,h)}if(i){var x=Pn(n,o[z],l),T=(s[4]?s[4]:"")+(s[5]?s[5]:"");if(x!==T)throw new Tt(n,r,Et[F],x,T)}}else if(s[10]){var l=on(s[10]);s[8]?o=jn(n,r,sn[u](s[8]),l):o=Fn(n,r,l);if(!o){var h=n[e]===Nt?Et[E]:Et[S];throw new Tt(n,r,h)}if(l<8||l>=112){if(!s[12])throw new Tt(n,r,Et[at]);var N=tn[u](s[12].toLowerCase());if(!Jt(N))throw new Tt(n,r,Et[Q],s[12]);o=new kn(o,N);if(i&&!s[11])throw new Tt(n,r,Et[J])}else if(s[12])throw new Tt(n,r,Et[ut])}if(i){if(o[dt]()!==(s[6]||s[9])){var h=o[dt]()?Et[Y]:Et[Z];throw new Tt(n,r,h)}var C=Dn(n,o),k=s[13]?s[13]:"";if(C!==k)throw new Tt(n,r,Et[P],C,k)}return o}function jn(n,i,s,o){var u=o-16+n[e]*32;if((u&136)!==0)throw new Tt(n,i,Et[f]);var a=o%16;if(a-s===1)u-=1;else{if(a-s!==-1)throw new Tt(n,i,Et[f]);u+=1}if(n[t][u]!==Pt*2+n[e])throw new Tt(n,i,Et[f]);var l=n[t][o];if(l<0){if(o===(5-n[e]*3)*16+n[r])return On(n,u,o,(4-n[e])*16+n[r],-1)}else if(l%2!==n[e])return On(n,u,o,-1,-1);throw new Tt(n,i,Et[f])}function Fn(n,r,i){var s=16-n[e]*32,o=i-s;if((o&136)!==0)throw new Tt(n,r,Et[l]);if(n[t][i]>=0)throw new Tt(n,r,Et[l]);var u=Pt*2+n[e];if(n[t][o]===u)return On(n,o,i,-1,-1);if(n[t][o]<0){o-=s;var a=(1+n[e]*5)*16;if(o>=a&&o<a+8&&n[t][o]===u)return On(n,o,i,-1,i%16)}throw new Tt(n,r,Et[l])}var e="_turn",t="_board",n="prototype",r="_enPassant",i="_castleRights",s=!1,o="string",u="indexOf",a="length",f="INVALID_CAPTURING_PAWN_MOVE",l="INVALID_NON_CAPTURING_PAWN_MOVE",c=null,h=!0,p="_movingPiece",d="_legal",v="_king",m="undefined",g="INVALID_MOVE_COUNTING_FIELD",y="TWO_SQUARE_PAWN_MOVE",b="CASTLING_MOVE",w="EN_PASSANT_CAPTURE",E="NOT_SAFE_FOR_WHITE_KING",S="NOT_SAFE_FOR_BLACK_KING",x="_twoSquarePawnMoveColumn",T="UNEXPECTED_END_OF_SUBFIELD_IN_BOARD_FIELD",N="WRONG_NUMBER_OF_SUBFIELDS_IN_BOARD_FIELD",C="+---+---+---+---+---+---+---+---+\n",k="UNEXPECTED_CHARACTER_IN_BOARD_FIELD",L="_isCapture",A="NO_PIECE_CAN_MOVE_TO_DISAMBIGUATION",O="TRYING_TO_CAPTURE_YOUR_OWN_PIECES",M="WRONG_ROW_IN_EN_PASSANT_FIELD",_="INVALID_MOVE_NOTATION_SYNTAX",D="isLegal",P="WRONG_CHECK_CHECKMATE_SYMBOL",H="_type",B="_movingColor",j="INVALID_CASTLE_RIGHTS_FIELD",F="WRONG_DISAMBIGUATION_SYMBOL",I="ILLEGAL_QUEEN_SIDE_CASTLING",q="message",R="Position#castleRights()",U="WRONG_NUMBER_OF_FEN_FIELDS",z="_from",W="ILLEGAL_KING_SIDE_CASTLING",X="_enPassantSquare",V="INVALID_EN_PASSANT_FIELD",$="Position#isAttacked()",J="MISSING_PROMOTION_SYMBOL",K="floor",Q="INVALID_PROMOTED_PIECE",G="test",Y="MISSING_CAPTURE_SYMBOL",Z="INVALID_CAPTURE_SYMBOL",et="REQUIRE_DISAMBIGUATION",tt="_promotion",nt="NO_PIECE_CAN_MOVE_TO",rt="ORDINALS",it="Position#square()",st="INVALID_TURN_FIELD",ot="PROMOTION",ut="ILLEGAL_PROMOTION",at="MISSING_PROMOTION",ft="boolean",lt="-",ct="ILLEGAL_POSITION",ht="object",pt="_rookFrom",dt="isCapture",vt="promotion",mt="isNullMoveLegal",gt="hasMove",yt=" ",bt="fiftyMoveClock",wt="fullMoveNumber",Et={};Et[rt]=["1st","2nd","3rd","4th","5th","6th","7th","8th"],Et[U]="A FEN string must contain exactly 6 space-separated fields.",Et[N]="The 1st field of a FEN string must contain exactly 8 `/`-separated subfields.",Et[k]="Unexpected character in the 1st field of the FEN string: `%1$s`.",Et[T]="The %1$s subfield of the FEN string 1st field is unexpectedly short.",Et[st]="The 2nd field of a FEN string must be either `w` or `b`.",Et[j]="The 3rd field of a FEN string must be either `-` or a list of characters among `K`, `Q`, `k` and `q` (in this order).",Et[V]="The 4th field of a FEN string must be either `-` or a square from the 3rd or 6th row where en-passant is allowed.",Et[M]="The row number indicated in the FEN string 4th field is inconsistent with respect to the 2nd field.",Et[g]="The %1$s field of a FEN string must be a number.",Et[_]="The syntax of the move notation is invalid.",Et[ct]="The position is not legal.",Et[I]="Queen-side castling is not legal in the considered position.",Et[W]="King-side castling is not legal in the considered position.",Et[nt]="No %1$s can move to %2$s.",Et[A]="No %1$s on the specified row/column can move to %2$s.",Et[et]="Cannot determine uniquely which %1$s is supposed to move to %2$s.",Et[F]="Wrong disambiguation symbol (expected: `%1$s`, observed: `%2$s`).",Et[O]="Capturing its own pieces is not legal.",Et[f]="Invalid capturing pawn move.",Et[l]="Invalid non-capturing pawn move.",Et[E]="This move would put let the white king in check.",Et[S]="This move would put let the black king in check.",Et[at]="A promoted piece must be specified for this move.",Et[J]="Character `=` is required to specify a promoted piece.",Et[Q]="%1$s cannot be specified as a promoted piece.",Et[ut]="Specifying a promoted piece is illegal for this move.",Et[Y]="Capture symbol `x` is missing.",Et[Z]="This move is not a capture move.",Et[P]="Wrong check/checkmate symbol (expected: `%1$s`, observed: `%2$s`).";var Nt=0,Ct=1,kt=-1,Lt=-2,At=0,Ot=1,Mt=2,_t=3,Dt=4,Pt=5,Ht=0,Bt=1,jt=2,Ft=3,It=4,qt=5,Rt=6,Ut=7,zt=8,Wt=9,Xt=10,Vt=11,Kt=[[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-16,-1,1,16],[-16,-1,1,16],[-17,-15,15,17],[-17,-15,15,17],[-33,-31,-18,-14,14,18,31,33],[-33,-31,-18,-14,14,18,31,33],[15,17],[-17,-15]],Qt=[204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,0,768,2255,2111,2255,768,0,0,0,0,0,0,60,60,60,60,60,60,63,0,63,60,60,60,60,60,60,0,0,0,0,0,0,768,1231,1087,1231,768,0,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0],Gt=[-17,0,0,0,0,0,0,-16,0,0,0,0,0,0,-15,0,0,-17,0,0,0,0,0,-16,0,0,0,0,0,-15,0,0,0,0,-17,0,0,0,0,-16,0,0,0,0,-15,0,0,0,0,0,0,-17,0,0,0,-16,0,0,0,-15,0,0,0,0,0,0,0,0,-17,0,0,-16,0,0,-15,0,0,0,0,0,0,0,0,0,0,-17,0,-16,0,-15,0,0,0,0,0,0,0,0,0,0,0,0,-17,-16,-15,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,15,16,17,0,0,0,0,0,0,0,0,0,0,0,0,15,0,16,0,17,0,0,0,0,0,0,0,0,0,0,15,0,0,16,0,0,17,0,0,0,0,0,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,0,0,0,15,0,0,0,0,16,0,0,0,0,17,0,0,0,0,15,0,0,0,0,0,16,0,0,0,0,0,17,0,0,15,0,0,0,0,0,0,16,0,0,0,0,0,0,17,0],en="KkQqRrBbNnPp",tn="kqrbnp",nn="wb",rn="12345678",sn="abcdefgh";fn[n].clear=function(){this[t]=[kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt],this[e]=Nt,this[i]=[0,0],this[r]=-1,this[d]=s,this[v]=[-1,-1]},fn[n].reset=function(){this[t]=[It,zt,Rt,jt,Ht,Rt,zt,It,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Xt,Xt,Xt,Xt,Xt,Xt,Xt,Xt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,kt,kt,kt,kt,kt,kt,kt,kt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Vt,Vt,Vt,Vt,Vt,Vt,Vt,Vt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,qt,Wt,Ut,Ft,Bt,Ut,Wt,qt],this[e]=Nt,this[i]=[129,129],this[r]=-1,this[d]=h,this[v]=[4,116]},fn[n].ascii=function(){var n=C;for(var s=7;s>=0;--s){for(var o=0;o<8;++o){var u=this[t][s*16+o];n+="| "+(u<0?yt:en[u])+yt}n+="|\n",n+=C}return n+=nn[this[e]]+yt,n+=hn(this[i])+yt,n+=this[r]<0?lt:sn[this[r]],n},fn[n].fen=function(){if(arguments[a]===0)return ln(this,0,1);if(arguments[a]===1&&typeof arguments[0]===ht){var e=typeof arguments[0][bt]=="number"?arguments[0][bt]:0,t=typeof arguments[0][wt]=="number"?arguments[0][wt]:1;return ln(this,e,t)}if(arguments[a]===1&&typeof arguments[0]===o)return cn(this,arguments[0],s);if(arguments[a]>=2&&typeof arguments[0]===o&&typeof arguments[1]===ft)return cn(this,arguments[0],arguments[1]);throw new St("Position#fen()")},fn[n].square=function(e,t){e=on(e);if(e<0)throw new St(it);if(typeof t===m||t===c)return dn(this,e);if(!vn(this,e,t))throw new St(it)},fn[n].turn=function(e){if(typeof e===m||e===c)return mn(this);if(!gn(this,e))throw new St("Position#turn()")},fn[n].castleRights=function(e,t,n){e=un(e);if(e<0||t!=="k"&&t!=="q")throw new St(R);var r=t==="k"?7:0;if(typeof n===m||n===c)return yn(this,e,r);if(!bn(this,e,r,n))throw new St(R)},fn[n].enPassant=function(e){if(typeof e===m||e===c)return wn(this);if(!En(this,e))throw new St("Position#enPassant()")},fn[n].isAttacked=function(e,t,n){e=on(e),t=un(t);if(e<0||t<0)throw new St($);if(typeof n===m||n===c)return xn(this,e,t);if(typeof n===o){for(var r=0;r<tn[a];++r)if(n[u](tn[r])>=0&&Sn(this,e,r*2+t))return h;return s}throw new St($)},fn[n][D]=function(){return Tn(this),this[d]},fn[n].kingSquare=function(e){e=un(e);if(e<0)throw new St("Position#kingSquare()");Tn(this);var t=this[v][e];return t<0?lt:an(t)};var Cn={NORMAL_MOVE:0,CASTLING_MOVE:1,EN_PASSANT_CAPTURE:2,TWO_SQUARE_PAWN_MOVE:3,PROMOTION:4};return kn[n].type=function(){return this[H]},kn[n].movingPiece=function(){return tn[this[p]]},kn[n].movingColor=function(){return nn[this[B]]},kn[n][dt]=function(){return this[L]},kn[n].from=function(){return an(this[z])},kn[n].to=function(){return an(this._to)},kn[n].rookFrom=function(){return this[H]===Cn[b]?an(this[pt]):lt},kn[n].rookTo=function(){return this[H]===Cn[b]?an(this._rookTo):lt},kn[n].enPassantSquare=function(){return this[H]===Cn[w]?an(this[X]):lt},kn[n].twoSquarePawnMoveColumn=function(){return this[H]===Cn[y]?sn[this[x]]:lt},kn[n][vt]=function(){return this[H]===Cn[ot]?tn[this[tt]]:lt},fn[n].isCheck=function(){return this[D]()&&xn(this,this[v][this[e]],1-this[e])},fn[n].isCheckmate=function(){return this[D]()&&!this[gt]()&&xn(this,this[v][this[e]],1-this[e])},fn[n].isStalemate=function(){return this[D]()&&!this[gt]()&&!xn(this,this[v][this[e]],1-this[e])},fn[n].isMoveLegal=function(e){if(typeof e===o)try{return Bn(this,e,s)}catch(t){if(t instanceof Tt)return s;throw t}else if(typeof e===ht&&e!==c&&typeof e.from===o&&typeof e.to===o){var n=on(e.from),r=on(e.to);if(n>=0&&r>=0){if(typeof e[vt]!==o)return An(this,n,r,-1);var i=tn[u](e[vt]);if(i>=0)return An(this,n,r,i)}}throw new St("Position#isMoveLegal()")},fn[n][gt]=function(){function e(){}try{return Ln(this,function(t){if(t)throw new e}),s}catch(t){if(t instanceof e)return h;throw t}},fn[n].moves=function(){var e=[];return Ln(this,function(t,n){t&&(n?(e.push(new kn(t,Ot)),e.push(new kn(t,Mt)),e.push(new kn(t,_t)),e.push(new kn(t,Dt))):e.push(t))}),e},fn[n].play=function(n){var o=n instanceof kn?n:this.isMoveLegal(n);if(o){var u=o[H]===Cn[ot]?o[tt]*2+this[e]:this[t][o[z]];return this[t][o[z]]=kt,o[H]===Cn[w]?this[t][o[X]]=kt:o[H]===Cn[b]&&(this[t][o[pt]]=kt,this[t][o._rookTo]=Mt*2+this[e]),this[t][o._to]=u,o[p]===At&&(this[i][this[e]]=0),o[z]<8&&(this[i][Nt]&=~(1<<o[z])),o._to<8&&(this[i][Nt]&=~(1<<o._to)),o[z]>=112&&(this[i][Ct]&=~(1<<o[z]%16)),o._to>=112&&(this[i][Ct]&=~(1<<o._to%16)),this[r]=o[H]===Cn[y]?o[x]:-1,o[p]===At&&(this[v][this[e]]=o._to),this[e]=1-this[e],h}return s},fn[n][mt]=function(){return this[D]()&&!xn(this,this[v][this[e]],1-this[e])},fn[n].playNullMove=function(){return this[mt]()?(this[e]=1-this[e],this[r]=-1,h):s},fn[n].notation=function(){if(arguments[a]===1&&arguments[0]instanceof kn)return _n(this,arguments[0]);if(arguments[a]===1&&typeof arguments[0]===o)return Bn(this,arguments[0],s);if(arguments[a]>=2&&typeof arguments[0]===o&&typeof arguments[1]===ft)return Bn(this,arguments[0],arguments[1]);throw new St("Position#notation()")},{i18n:Et,exceptions:{IllegalArgument:St,InvalidFEN:xt,InvalidNotation:Tt},squareColor:Yt,squareToCoordinates:Zt,Position:fn,movetype:Cn,MoveDescriptor:kn}}();